---
title: 数据库索引原理
categories:
  - 笔记
tags:
  - 数据库
  - 索引
  - 平衡树
  - 磁盘存储
date: 2018-07-23 21:40:27
---
 这是摘要
 <!-- more -->

# 索引
## 优缺点
1. 优点
    1. 大大加快数据的检索速度，这也是创建索引的最主要的原因；
    2. 可以创建唯一性索引，保证数据库表中每一行数据的唯一性；
    3. 可以将表的外键制作为索引，加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义；
    4. 将随机I/O变为顺序I/O，帮助服务器避免排序和临时表，在使用分组和排序子句进行数据检索时，可以显著减少查询中分组和排序的时间；
    5. 通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。
2. 缺点
    1. 创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加；
    2. 索引需要占物理空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间；
    3. 当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，这样就降低了数据的维护速度。
3. 关于mysql索引:
    1. BTree 索引是大多数 MySQL 存储引擎的默认索引类型
    2. 在 MySQL 中只有 Memory 引擎显式支持哈希索引
    3. 哈希索引只包含 哈希值和行指针，而不存储字段值
    4. 索引将随机 I/O变为顺序 I/O

## innodb
### 行锁原理
### 与mylsam的区别

## 不同查询条件下的命中情况

## 聚集索引
## 加速原理
### 磁盘读写原理和效率
参考地址:https://blog.csdn.net/v_july_v/article/details/6530142
1. 读写数据时间的组成
    * 查找时间:就是磁头移动到需要的柱面上(一个圈就叫柱面),定位到指定磁道,时间代价最大,最大可达0.1s
    * 等待时间:盘片开始旋转,将指定的磁道段移动到磁头下,因为硬盘转速有7200转/分,所以转一圈的时间就0.0083s,很快
    * 传输时间:数据通过系统总线到内存的时间,传输一个byte0.02微秒(`2*10^-8`s)
2. 提速手段
    硬盘读取数据的速度是以块(block)为基本单位的,而磁盘IO的时间代价主要花费在查找时间,因此一方面要将相关数据放在相近的区域(同一盘块,同一磁道,或者至少放在同一柱面或者相邻柱面),减少读/写数据时来回移动磁头的次数

### B树(B-树)
也是一种多叉平衡查找树,一个节点内有x个关键字,那么这个节点就有x+1个子节点
{% asset_img b树的结构.jpg b树的结构%}
如上图树查找字母R的路径
{% asset_img b树文件查找过程.jpg b树文件查找过程%}
根节点中的17代表一个磁盘文件的文件名,**红色方块代表17文件在硬盘中的存储位置(这就是和B+树的主要区别)**,P1指向17的左子树.



### B+树的介绍
参考地址:http://blog.csdn.net/guoziqing506/article/details/64122287
与b树相比较
1. b+树的磁盘读写代价更低,因为b+树的内部节点**并没有指向关键字的指针的具体信息**,所以盘快内可以容纳更多的关键字,盘块读进内存后查找的范围更大,从而降低树的高度
2. 查询效率更加稳定,因为内部节点并不是指向最终文件内容的节点,而是指向关键字的节点,所以每一次查询都必须从根节点到叶子结点,长度相同
3. b树在解决io效率的时候并没有解决元素遍历效率低下的问题,而b+树只需要遍历叶子节点就能解决对所有关键字的查询,对于数据库中经常使用的范围查询性能更高
{% asset_img b+树的文件查找结构.jpg b+树的文件查找结构}

### 红黑树

### 创建索引的原则:
1. 最左前缀匹配原则
2. =和in可以乱序,mysql会自动优化
3. 尽量选择区分度高的列来做索引
4. 索引列不能参与计算
5. 尽量扩展索引而不是新建