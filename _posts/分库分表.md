---
title: 分库分表
categories:
  - 笔记
tags:
  - null
date: 2018-08-20 21:15:11
---
 参考地址:http://www.infoq.com/cn/articles/key-steps-and-likely-problems-of-split-table
 <!-- more -->

## 垂直分表
就是大表拆成小表,一张表字段过多可以考虑拆分成几张表,将不经常使用或者长度较大的字段拆分出去放到“扩展表”中
1. 优点
在字段很多的情况下，拆分开确实更便于开发和维护。某种意义上也能避免“跨页”的问题
2. 缺点
拆分字段的操作建议在数据库设计阶段就做好。如果是在发展过程中拆分，则需要改写以前的查询语句，会额外带来一定的成本和风险，建议谨慎。

## 垂直分库
基本的思路就是按照业务模块来划分出不同的数据库，而不是像早期一样将所有的数据表都放到同一个数据库中。
1. 优点
系统层面的“服务化”拆分操作，能够解决业务系统层面的耦合和性能瓶颈，有利于系统的扩展维护。而数据库层面的拆分，道理也是相通的。与服务的“治理”和“降级”机制类似，我们也能对不同业务类型的数据进行“分级”管理、维护、监控、扩展等。
数据库的连接资源比较宝贵且单机处理能力也有限，在高并发场景下，垂直分库一定程度上能够突破IO、连接数及单机硬件资源的瓶颈，是大型分布式系统中优化数据库架构的重要手段。
2. 缺点
跨库join，分布式事务等
3. 难点解决思路
	1. 垮库join
		* 字段冗余:
		可以不用去查询另一张表,空间换时间
		* 简单字段,系统层组装
		在代码中调用不同模块的服务获取数据后进行组装
		* 复杂字段
		尽量将数据通过条件过滤之后再返回进行组装
	2. 跨库事务（分布式事务）的问题	

## 水平分表
就是将表中不同的数据行按照一定规律分布到不同的数据库表中（这些表保存在同一个数据库中），这样来降低单表数据量，优化查询性能。最常见的方式就是通过主键或者时间等字段进行Hash和取模后拆分。
1. 优点
水平分表，能够降低单表的数据量，一定程度上可以缓解查询性能瓶颈。
2. 缺点
但本质上这些表还保存在同一个库中，所以库级别还是会有IO瓶颈。所以，一般不建议采用这种做法。

## 水平分库分表
水平分库分表与上面讲到的水平分表的思想相同，唯一不同的就是将这些拆分出来的表保存在不同的数据中。
>参考地址:http://www.infoq.com/cn/articles/key-steps-and-likely-problems-of-horizontal-split-table

